{"version":3,"sources":["../src/WebhookReceiver.test.ts"],"sourcesContent":["// SPDX-FileCopyrightText: 2024 LiveKit, Inc.\n//\n// SPDX-License-Identifier: Apache-2.0\nimport { describe, expect, it } from 'vitest';\nimport { AccessToken } from './AccessToken.js';\nimport { WebhookEvent, WebhookReceiver } from './WebhookReceiver.js';\n\nconst testApiKey = 'abcdefg';\nconst testSecret = 'abababa';\n\ndescribe('webhook receiver', () => {\n  const body =\n    '{\"event\":\"room_started\", \"room\":{\"sid\":\"RM_TkVjUvAqgzKz\", \"name\":\"mytestroom\", \"emptyTimeout\":300, \"creationTime\":\"1628545903\", \"turnPassword\":\"ICkSr2rEeslkN6e9bXL4Ji5zzMD5Z7zzr6ulOaxMj6N\", \"enabledCodecs\":[{\"mime\":\"audio/opus\"}, {\"mime\":\"video/VP8\"}]}}';\n  const sha = 'CoEQz1chqJ9bnZRcORddjplkvpjmPujmLTR42DbefYI=';\n  const t = new AccessToken(testApiKey, testSecret);\n  t.sha256 = sha;\n\n  const receiver = new WebhookReceiver(testApiKey, testSecret);\n\n  it('should receive and decode WebhookEvent', async () => {\n    const token = await t.toJwt();\n    const event = await receiver.receive(body, token);\n    expect(event).toBeTruthy();\n    expect(event.room?.name).toBe('mytestroom');\n    expect(event.event).toBe('room_started');\n  });\n});\n\ndescribe('decoding json payload', () => {\n  it('should allow server to return extra fields', () => {\n    const obj = {\n      type: 'room_started',\n      room: {\n        sid: 'RM_TkVjUvAqgzKz',\n        name: 'mytestroom',\n      },\n      extra: 'extra',\n    };\n\n    const event = new WebhookEvent(obj);\n    expect(event).toBeTruthy();\n    expect(event.room?.name).toBe('mytestroom');\n  });\n});\n"],"mappings":"AAGA,SAAS,UAAU,QAAQ,UAAU;AACrC,SAAS,mBAAmB;AAC5B,SAAS,cAAc,uBAAuB;AAE9C,MAAM,aAAa;AACnB,MAAM,aAAa;AAEnB,SAAS,oBAAoB,MAAM;AACjC,QAAM,OACJ;AACF,QAAM,MAAM;AACZ,QAAM,IAAI,IAAI,YAAY,YAAY,UAAU;AAChD,IAAE,SAAS;AAEX,QAAM,WAAW,IAAI,gBAAgB,YAAY,UAAU;AAE3D,KAAG,0CAA0C,YAAY;AAnB3D;AAoBI,UAAM,QAAQ,MAAM,EAAE,MAAM;AAC5B,UAAM,QAAQ,MAAM,SAAS,QAAQ,MAAM,KAAK;AAChD,WAAO,KAAK,EAAE,WAAW;AACzB,YAAO,WAAM,SAAN,mBAAY,IAAI,EAAE,KAAK,YAAY;AAC1C,WAAO,MAAM,KAAK,EAAE,KAAK,cAAc;AAAA,EACzC,CAAC;AACH,CAAC;AAED,SAAS,yBAAyB,MAAM;AACtC,KAAG,8CAA8C,MAAM;AA7BzD;AA8BI,UAAM,MAAM;AAAA,MACV,MAAM;AAAA,MACN,MAAM;AAAA,QACJ,KAAK;AAAA,QACL,MAAM;AAAA,MACR;AAAA,MACA,OAAO;AAAA,IACT;AAEA,UAAM,QAAQ,IAAI,aAAa,GAAG;AAClC,WAAO,KAAK,EAAE,WAAW;AACzB,YAAO,WAAM,SAAN,mBAAY,IAAI,EAAE,KAAK,YAAY;AAAA,EAC5C,CAAC;AACH,CAAC;","names":[]}