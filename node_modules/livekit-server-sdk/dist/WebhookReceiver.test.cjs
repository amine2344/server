"use strict";
var import_vitest = require("vitest");
var import_AccessToken = require("./AccessToken.cjs");
var import_WebhookReceiver = require("./WebhookReceiver.cjs");
const testApiKey = "abcdefg";
const testSecret = "abababa";
(0, import_vitest.describe)("webhook receiver", () => {
  const body = '{"event":"room_started", "room":{"sid":"RM_TkVjUvAqgzKz", "name":"mytestroom", "emptyTimeout":300, "creationTime":"1628545903", "turnPassword":"ICkSr2rEeslkN6e9bXL4Ji5zzMD5Z7zzr6ulOaxMj6N", "enabledCodecs":[{"mime":"audio/opus"}, {"mime":"video/VP8"}]}}';
  const sha = "CoEQz1chqJ9bnZRcORddjplkvpjmPujmLTR42DbefYI=";
  const t = new import_AccessToken.AccessToken(testApiKey, testSecret);
  t.sha256 = sha;
  const receiver = new import_WebhookReceiver.WebhookReceiver(testApiKey, testSecret);
  (0, import_vitest.it)("should receive and decode WebhookEvent", async () => {
    var _a;
    const token = await t.toJwt();
    const event = await receiver.receive(body, token);
    (0, import_vitest.expect)(event).toBeTruthy();
    (0, import_vitest.expect)((_a = event.room) == null ? void 0 : _a.name).toBe("mytestroom");
    (0, import_vitest.expect)(event.event).toBe("room_started");
  });
});
(0, import_vitest.describe)("decoding json payload", () => {
  (0, import_vitest.it)("should allow server to return extra fields", () => {
    var _a;
    const obj = {
      type: "room_started",
      room: {
        sid: "RM_TkVjUvAqgzKz",
        name: "mytestroom"
      },
      extra: "extra"
    };
    const event = new import_WebhookReceiver.WebhookEvent(obj);
    (0, import_vitest.expect)(event).toBeTruthy();
    (0, import_vitest.expect)((_a = event.room) == null ? void 0 : _a.name).toBe("mytestroom");
  });
});
//# sourceMappingURL=WebhookReceiver.test.cjs.map